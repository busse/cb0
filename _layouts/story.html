---
layout: default
---
<main class="container page-story">
  {%- assign story_idea_numbers = page.related_ideas | default: "" -%}
  {%- assign story_parent_ideas = "" | split: "" -%}
  {%- for idea_number in story_idea_numbers -%}
    {%- assign idea_obj = site.ideas | where: "idea_number", idea_number | first -%}
    {%- if idea_obj -%}
      {%- assign story_parent_ideas = story_parent_ideas | push: idea_obj -%}
    {%- endif -%}
  {%- endfor -%}
  {%- assign primary_parent = story_parent_ideas[0] -%}
  {%- assign primary_parent_number = primary_parent.idea_number | default: (page.related_ideas | first) -%}
  {% include navigation/breadcrumbs.html idea=primary_parent story=page %}
  
  <section class="header-region">
    <div class="header-primary">
      <article class="story-detail">
        <header class="story-detail__header">
          <div class="story-header">
            {% include notation-badge.html idea=primary_parent_number story=page.story_number size="lg" %}
            <span class="status-indicator status-indicator--{{ page.status }}">{{ page.status | replace: "-", " " | upcase }}</span>
            <span class="priority-indicator priority-indicator--{{ page.priority }}">{{ page.priority | upcase }} PRIORITY</span>
          </div>
          
          <h1 class="page-title">{{ page.title }}</h1>
          
          <div class="story-detail__meta">
            {%- if page.related_sprints and page.related_sprints != '' and page.related_sprints.size > 0 -%}
              <span class="story-detail__sprint">
                Sprints:
                {%- for sprint_id in page.related_sprints -%}
                  <a href="{{ '/sprint/' | append: sprint_id | append: '/' | relative_url }}">{% include notation-badge.html sprint=sprint_id size="sm" %}</a>{% unless forloop.last %}, {% endunless %}
                {%- endfor -%}
              </span>
            {%- else -%}
              <span class="story-detail__sprint story-detail__sprint--backlog">Backlog</span>
            {%- endif -%}
            <time class="story-detail__date" datetime="{{ page.created }}">Created: {{ page.created | date: "%B %d, %Y" }}</time>
          </div>
          
          {%- if story_parent_ideas.size > 0 -%}
            <p class="story-detail__parent">
              Part of:
              {%- for idea in story_parent_ideas -%}
                <a href="{{ idea.url | relative_url }}">{% include notation-badge.html idea=idea.idea_number size="sm" %} {{ idea.title }}</a>{% unless forloop.last %}, {% endunless %}
              {%- endfor -%}
            </p>
          {%- endif -%}
        </header>

        {%- if page.description -%}
          <div class="story-detail__description">
            <h2 class="section-title">DESCRIPTION</h2>
            <p>{{ page.description }}</p>
          </div>
        {%- endif -%}
        
        <div class="story-content">
          {{ content }}
        </div>
      </article>
    </div>
    
    <aside class="header-sidebar">
      {% include helpers/relationships-sidebar.html record=page layout=page.layout %}
    </aside>
  </section>

    {%- include helpers/updates-for-story.html story=page -%}
    {%- if story_updates.size > 0 -%}
      <section class="content-section">
        <header class="section-header">
          <h2 class="section-title">UPDATES</h2>
          <span class="section-count">{{ story_updates.size }} total</span>
        </header>
        <ul class="update-timeline">
          {%- for update in story_updates -%}
            <li class="update-timeline__item">
              <span class="update-timeline__notation">{% include notation-badge.html sprint=update.sprint_id idea=update.idea_number story=update.story_number size="sm" %}</span>
              <time class="update-timeline__date" datetime="{{ update.date }}">{{ update.date | date: "%b %d, %Y" }}</time>
              <span class="update-timeline__type">{{ update.type }}</span>
              <a href="{{ update.url | relative_url }}" class="update-timeline__link">View update</a>
            </li>
          {%- endfor -%}
        </ul>
      </section>
    {%- endif -%}
</main>

